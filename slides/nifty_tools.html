<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!--[if lt IE 9]>
  <script src="lib/html5shim.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="lib/styles.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pygments.css">

  <title>XML Summer School | Practical Web Applications</title>
</head>
<body>
  <header>
	<h1>XML Summer School 2011 | Practical Web Applications</h1>
	<nav>
		<ul>
			<li><button id="prev-btn" title="Previous slide">Previous Slide</button></li>
			<li>
<span id="slide-number"></span>/<span id="slide-total"></span>
</li>
			<li><button id="next-btn" title="Next Slide">Next Slide</button></li>
		</ul>
    </nav>
  </header>

  <div id="deck">
    <section class="title">
      <a href="http://www.xmlsummerschool.com" class="logo"><img src="images/xsslogo.jpg"></a>
      <hgroup>
        <h1>Practical Web Apps</h1>
        <h2>22nd September 2011</h2>
      </hgroup>
      <p><img class="banner" src="images/xssbanner.png"></p>
      <aside>
        <h2>Nifty Tools</h2>
        <p>Matt Patterson &amp; Paul Downey</p>
      </aside>
      <footer>
        <a href="http://creativecommons.org/licenses/by/3.0/"><img src="images/cc.png" class="license"></a>
        <p class="link"><a href="http://www.xmlsummerschool.com">www.xmlsummerschool.com</a></p>
      </footer>
    </section>
    <section>
      <hgroup><h1>Overview</h1></hgroup>
      <ul>
        <li>Reading</li>
        <li>Writing</li>
        <li>DOM Scripting</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Reading</h1></hgroup>
      <p>simple XPath
         CSS Selectors
         More complex documents
         simple (complex) XPath - custom functions
      </p>
    </section>
    <section>
      <hgroup><h1>Nokogiri</h1></hgroup>
      <ul>
        <li><a href="http://nokogiri.org/">http://nokogiri.org/</a></li>
        <li>A Ruby wrapper around GNOME's LibXML 2 / LibXSLT</li>
        <li>Provides a simple and expressive API</li>
        <li>MIT licensed</li>
      </ul>
      <h3>Nokogiri is a Rubygem</h3>
      <ul>
        <li><a href="http://rubygems.org/">http://rubygems.org/</a></li>
        <li>Ruby's pan-OS package manager</li>
        <li>Provided you have the development headers for libxml2 and
libxslt, and a C compiler, installation is as simple as:</li>
      </ul>
      <div class="highlight">
<pre>gem install nokogiri
</pre>
</div>

      <ul>
        <li>There are pre-built binary versions of the gem for
Windows</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Simple parsing</h1></hgroup>
      <ul>
        <li>Here's what you need to do in order to parse a document and get something out</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">'http://w3.org/'</span><span class="p">))</span>
</pre>
</div>

      <ul>
        <li>Nokogiri provides two parsing modes: HTML (more lenient) &amp; XML</li>
      </ul>
      <div class="highlight">
<pre><span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'/path/to/xml'</span><span class="p">))</span>
<span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="s1">'&lt;html&gt;&lt;head&gt;&lt;title&gt;HTML&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">)</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath</h1></hgroup>
      <ul>
        <li>In the simple case</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">interesting_url</span> <span class="o">=</span> <span class="s1">'http://www.bbc.co.uk/radio3/programmes/schedules'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using XPath</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'//a'</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">index</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=~</span> <span class="sr">/Late Junction/</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'id("evening")) == doc.xpath('</span><span class="nb">id</span><span class="p">(</span><span class="s2">"evening"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span> <span class="c1"># =&gt; true</span>
<span class="c1"># context node is set for you:</span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Nokogiri's NodeSets</h1></hgroup>
      <ul>
        <li>NodeSets behave a lot like Nodes for things like continuing to
search</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5</span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5 </span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("broadcasts")/li'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span>
  <span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 1 </span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("broadcasts")/li'</span><span class="p">)</span><span class="o">.</span>
  <span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 13 </span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with CSS selectors</h1></hgroup>
      <ul>
        <li>Nokogiri supports CSS3 Selectors</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">interesting_url</span> <span class="o">=</span> <span class="s1">'http://www.bbc.co.uk/radio3/programmes/schedules'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using CSS</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'div.episode span.title'</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">index</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span> <span class="o">==</span> <span class="s1">'Late Junction'</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_css</span><span class="p">(</span><span class="s1">'#broadcasts'</span><span class="p">)</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Traversal</h1></hgroup>
      <ul>
        <li>Nokogiri's DOMish API </li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using traversal</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">doc</span><span class="o">.</span><span class="n">traverse</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">nodes</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text?</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=~</span> <span class="sr">/Late Junction/</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">unless</span> <span class="n">nodes</span><span class="o">.</span><span class="n">empty?</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Traversal</h1></hgroup>
      <ul>
        <li>Nokogiri's DOMish API </li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">at_css</span><span class="p">(</span><span class="s1">'#broadcasts'</span><span class="p">)</span>

<span class="n">node</span><span class="o">.</span><span class="n">previous</span> <span class="c1"># node.previous_sibling</span>
<span class="n">node</span><span class="o">.</span><span class="n">next</span>     <span class="c1"># node.next_sibling</span>
<span class="n">node</span><span class="o">.</span><span class="n">children</span>
<span class="n">node</span><span class="o">.</span><span class="n">element_children</span>
<span class="n">node</span><span class="o">.</span><span class="n">text?</span>
<span class="n">node</span><span class="o">.</span><span class="n">cdata?</span>
<span class="n">node</span><span class="o">.</span><span class="n">element?</span>
<span class="n">node</span><span class="o">.</span><span class="n">attributes</span>
<span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="c1"># =&gt; 'periods'</span>
<span class="n">node</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;Nokogiri::XML::Attr:0x3fd840c77830 name="class" value="periods"&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath (again)</h1></hgroup>
      <ul>
        <li>Working with Namespaces</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'//prefix:elementName'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="s1">'http://example.org/ns'</span><span class="p">})</span>
</pre>
</div>

      <ul>
        <li>And variables</li>
      </ul>
       <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'.//address[@domestic=$value]'</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="p">{</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="s1">'Yes'</span><span class="p">})</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath (again)</h1></hgroup>
      <ul>
        <li>And custom functions</li>
      </ul>
      <div class="highlight">
<pre><span class="k">class</span> <span class="nc">CustomFunctions</span>
  <span class="k">def</span> <span class="nf">ftw</span><span class="p">(</span><span class="n">node_set</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span>
    <span class="c1"># do something clever here which returns an Array of nodes</span>
    <span class="n">node_set</span><span class="o">.</span><span class="n">find_all</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="no">ModelClass</span><span class="o">.</span><span class="n">validate_thing</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'//element[ftw(., @useful)]'</span><span class="p">,</span> <span class="no">CustomFunctions</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</pre>
</div>

      <ul>
        <li>Although, to be honest, I've never needed to do either of
        those last two</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>I've got a REPL and I'm not afraid to use it</h1></hgroup>
      <ul>
        <li>Fire up the interactive Ruby interpreter and try it out</li>
        <li>The delegate machines and the VirtualBox image are already
        set up for you</li>
        <li>Try parsing a couple of webpages (don't forget to require
        open-uri) or some files you have locally</li>
      </ul>
      <div class="highlight">
<pre><span class="nv">$ </span>irb
ruby-1.9.2-p290 :001 &gt;
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Writing</h1></hgroup>
      <p>Builder
        DOM-ish with Nokogiri
        Namespaces, oh my!
      </p>
    </section>
    <section>
      <hgroup><h1>DOM scripting</h1></hgroup>
    </section>
	</div>


	<script src="lib/jquery-1.5.2.min.js"></script>
	<script src="lib/jquery.jswipe-0.1.2.js"></script>
	<script src="lib/htmlSlides.js"></script>
	<script>
$(function() {
		htmlSlides.init({ hideToolbar: true });
});
	</script>
</body>
</html>
