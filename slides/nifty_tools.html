<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!--[if lt IE 9]>
  <script src="lib/html5shim.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="lib/styles.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pygments.css">

  <title>XML Summer School | Practical Web Applications</title>
</head>
<body>
  <header>
	<h1>XML Summer School 2011 | Practical Web Applications</h1>
	<nav>
		<ul>
			<li><button id="prev-btn" title="Previous slide">Previous Slide</button></li>
			<li>
<span id="slide-number"></span>/<span id="slide-total"></span>
</li>
			<li><button id="next-btn" title="Next Slide">Next Slide</button></li>
		</ul>
    </nav>
  </header>

  <div id="deck">
    <section class="title">
      <a href="http://www.xmlsummerschool.com" class="logo"><img src="images/xsslogo.jpg"></a>
      <hgroup>
        <h1>Practical Web Apps</h1>
        <h2>22nd September 2011</h2>
      </hgroup>
      <p><img class="banner" src="images/xssbanner.png"></p>
      <aside>
        <h2>Nifty Tools</h2>
        <p>Matt Patterson &amp; Paul Downey</p>
      </aside>
      <footer>
        <a href="http://creativecommons.org/licenses/by/3.0/"><img src="images/cc.png" class="license"></a>
        <p class="link"><a href="http://www.xmlsummerschool.com">www.xmlsummerschool.com</a></p>
      </footer>
    </section>
    <section>
      <hgroup><h1>Overview</h1></hgroup>
      <ul>
        <li>Reading</li>
        <li>Writing</li>
        <li>DOM Scripting</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Reading</h1></hgroup>
      <ul>
        <li>Parsing with Nokogiri</li>
        <li>Finding things with XPath and CSS Selectors</li>
        <li>More complex documents (namespaces)</li>
        <li>simple (complex) XPath - custom functions</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Nokogiri</h1></hgroup>
      <ul>
        <li><a href="http://nokogiri.org/">http://nokogiri.org/</a></li>
        <li>A Ruby wrapper around GNOME's LibXML 2 / LibXSLT</li>
        <li>Provides a simple and expressive API</li>
        <li>MIT licensed</li>
      </ul>
      <h3>Nokogiri is a Rubygem</h3>
      <ul>
        <li><a href="http://rubygems.org/gems/nokogiri">http://rubygems.org/gems/nokogiri</a></li>
        <li>Ruby's pan-OS package manager</li>
        <li>Provided you have the development headers for libxml2 and
libxslt, and a C compiler, installation is as simple as:</li>
      </ul>
      <div class="highlight">
<pre>gem install nokogiri
</pre>
</div>

      <ul>
        <li>There are pre-built binary versions of the gem for
Windows</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Simple parsing</h1></hgroup>
      <ul>
        <li>Here's what you need to do in order to parse a document and get something out</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">'http://w3.org/'</span><span class="p">))</span>
</pre>
</div>

      <ul>
        <li>Nokogiri provides two parsing modes: HTML (more lenient) &amp; XML</li>
      </ul>
      <div class="highlight">
<pre><span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'/path/to/xml'</span><span class="p">))</span>
<span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="s1">'&lt;html&gt;&lt;head&gt;&lt;title&gt;HTML&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">)</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath</h1></hgroup>
      <ul>
        <li>In the simple case</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">interesting_url</span> <span class="o">=</span> <span class="s1">'http://www.bbc.co.uk/radio3/programmes/schedules'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using XPath</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'//a'</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">index</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=~</span> <span class="sr">/Late Junction/</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'id("evening")) == doc.xpath('</span><span class="nb">id</span><span class="p">(</span><span class="s2">"evening"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span> <span class="c1"># =&gt; true</span>
<span class="c1"># context node is set for you:</span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Nokogiri's NodeSets</h1></hgroup>
      <ul>
        <li>NodeSets behave a lot like Nodes for things like continuing to
search</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5</span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("evening")'</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 5 </span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("broadcasts")/li'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span>
  <span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 1 </span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'id("broadcasts")/li'</span><span class="p">)</span><span class="o">.</span>
  <span class="n">xpath</span><span class="p">(</span><span class="s1">'ol/li/div/div[@class="summary"]'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 13 </span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with CSS selectors</h1></hgroup>
      <ul>
        <li>Nokogiri supports CSS3 Selectors</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="n">interesting_url</span> <span class="o">=</span> <span class="s1">'http://www.bbc.co.uk/radio3/programmes/schedules'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using CSS</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'div.episode span.title'</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">index</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span> <span class="o">==</span> <span class="s1">'Late Junction'</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_css</span><span class="p">(</span><span class="s1">'#broadcasts'</span><span class="p">)</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Traversal</h1></hgroup>
      <ul>
        <li>Nokogiri's DOMish API </li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="c1"># Using traversal</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">doc</span><span class="o">.</span><span class="n">traverse</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
  <span class="n">nodes</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text?</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=~</span> <span class="sr">/Late Junction/</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="s1">'YAY!'</span> <span class="k">unless</span> <span class="n">nodes</span><span class="o">.</span><span class="n">empty?</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Traversal</h1></hgroup>
      <ul>
        <li>Nokogiri's DOMish API </li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">interesting_url</span><span class="p">))</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">at_css</span><span class="p">(</span><span class="s1">'#broadcasts'</span><span class="p">)</span>

<span class="n">node</span><span class="o">.</span><span class="n">previous</span> <span class="c1"># node.previous_sibling</span>
<span class="n">node</span><span class="o">.</span><span class="n">next</span>     <span class="c1"># node.next_sibling</span>
<span class="n">node</span><span class="o">.</span><span class="n">children</span>
<span class="n">node</span><span class="o">.</span><span class="n">element_children</span>
<span class="n">node</span><span class="o">.</span><span class="n">text?</span>
<span class="n">node</span><span class="o">.</span><span class="n">cdata?</span>
<span class="n">node</span><span class="o">.</span><span class="n">element?</span>
<span class="n">node</span><span class="o">.</span><span class="n">attributes</span>
<span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="c1"># =&gt; 'periods'</span>
<span class="n">node</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;Nokogiri::XML::Attr:0x3fd840c77830 name="class" value="periods"&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath (again)</h1></hgroup>
      <ul>
        <li>Working with Namespaces</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'//prefix:elementName'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="s1">'http://example.org/ns'</span><span class="p">})</span>
</pre>
</div>

      <ul>
        <li>And variables</li>
      </ul>
       <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'.//address[@domestic=$value]'</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="p">{</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="s1">'Yes'</span><span class="p">})</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Working with XPath (again)</h1></hgroup>
      <ul>
        <li>And custom functions</li>
      </ul>
      <div class="highlight">
<pre><span class="k">class</span> <span class="nc">CustomFunctions</span>
  <span class="k">def</span> <span class="nf">ftw</span><span class="p">(</span><span class="n">node_set</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span>
    <span class="c1"># do something clever here which returns an Array of nodes</span>
    <span class="n">node_set</span><span class="o">.</span><span class="n">find_all</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="no">ModelClass</span><span class="o">.</span><span class="n">validate_thing</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">doc</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">'//element[ftw(., @useful)]'</span><span class="p">,</span> <span class="no">CustomFunctions</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</pre>
</div>

      <ul>
        <li>Although, to be honest, I've never needed to do either of
        those last two</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>CSS selectors and namespaces</h1></hgroup>
      <div class="highlight">
<pre><span class="n">xml</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOD</span>
<span class="sh">&lt;xh:html xmlns:xh="http://www.w3.org/1999/xhtml"&gt;</span>
<span class="sh">  &lt;xh:head/&gt;</span>
<span class="sh">&lt;/xh:html&gt;</span>
<span class="no">EOD</span>

<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'html'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 0</span>
<span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'xh|html'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 1</span>
<span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'prefix|html'</span><span class="p">,</span> <span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="s1">'http://www.w3.org/1999/xhtml'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 1</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>CSS selectors (and cheating at namespaces)</h1></hgroup>
      <ul>
        <li>If you're dealing with the Default namespace (e.g. XHTML)
then you can pretend they're not there...</li>
      </ul>
      <div class="highlight">
<pre><span class="n">xml</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOD</span>
<span class="sh">&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;</span>
<span class="sh">  &lt;head&gt;&lt;/head&gt;</span>
<span class="sh">&lt;/html&gt;</span>
<span class="no">EOD</span>

<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'/html/head'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 0</span>
<span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'html &gt; head'</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 1</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>I've got a REPL and I'm not afraid to use it</h1></hgroup>
      <ul>
        <li>Fire up the interactive Ruby interpreter and try it out</li>
        <li>The delegate machines and the VirtualBox image are already
        set up for you</li>
        <li>Try parsing a couple of webpages (don't forget to require
        open-uri) or some files you have locally</li>
        <li>The Nokogiri tutorials (<a href="http://nokogiri.org/tutorials">http://nokogiri.org/tutorials</a>)
are a good reference.</li>
      </ul>
      <div class="highlight">
<pre><span class="nv">$ </span>irb
ruby-1.9.2-p290 :001 &gt;
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Writing</h1></hgroup>
      <ul>
        <li>Generating XML with Builder</li>
        <li>DOM-ish building and manipulation with Nokogiri</li>
        <li>Un-DOM-ish building and manipulation with Nokogiri</li>
        <li>More complex documents with Builder (Namespaces again)</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Builder</h1></hgroup>
      <ul>
        <li><a href="https://github.com/jimweirich/builder">https://github.com/jimweirich/builder</a></li>
        <li>A simple, idiomatic Ruby, XML generation syntax</li>
        <li>Built around blocks and dynamic method calls</li>
        <li>Simple</li>
        <li>MIT licensed</li>
      </ul>
      <h3>Builder is a Rubygem</h3>
      <ul>
        <li><a href="http://rubygems.org/gems/builder">http://rubygems.org/gems/builder</a></li>
        <li>It's pure ruby, so no platform gotchas and installation is,
again:</li>
      </ul>
      <div class="highlight">
<pre>gem install builder
</pre>
</div>


    </section>
    <section>
      <hgroup><h1>The simplest case</h1></hgroup>
      <ul>
        <li>Build and write a document to a string</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'builder'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Builder</span><span class="o">::</span><span class="no">XmlMarkup</span><span class="o">.</span><span class="n">new</span>
<span class="n">doc</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span> <span class="o">|</span><span class="n">html</span><span class="o">|</span>
  <span class="n">html</span><span class="o">.</span><span class="n">head</span> <span class="k">do</span> <span class="o">|</span><span class="n">head</span><span class="o">|</span>
    <span class="n">head</span><span class="o">.</span><span class="n">title</span> <span class="s2">"Hello there"</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># =&gt; "&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello there&lt;/title&gt;&lt;/head&gt;&lt;/html&gt;"</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>A more complete case</h1></hgroup>
      <ul>
        <li>XML declaration and indentation please</li>
        <li>Also, lets retrieve the result string after we're done</li>
      </ul>
      <div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'builder'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Builder</span><span class="o">::</span><span class="no">XmlMarkup</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:indent</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">instruct!</span>
<span class="c1"># n == node</span>
<span class="n">doc</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">.</span><span class="n">head</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">.</span><span class="n">title</span> <span class="s2">"Hello there"</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">doc</span><span class="o">.</span><span class="n">target!</span> <span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;html&gt;</span>
<span class="c1">#   &lt;head&gt;</span>
<span class="c1">#     &lt;title&gt;Hello there&lt;/title&gt;</span>
<span class="c1">#   &lt;/head&gt;</span>
<span class="c1"># &lt;/html&gt;"</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>A quick digression into how it actually works</h1></hgroup>
      <ul>
        <li>If you don't know how it works, Builder's simplicity will bite you</li>
        <li>Simplicity ~= Simplistic</li>
      </ul>
      <h4>Builder is (deliberately) very stupid</h4>
      <ol>
        <li>It's just writing at the end of a string or IO object</li>
        <li>It's just intercepting all method calls to itself (except a couple of
special ones) and assuming they're tag names</li>
      </ol>
      <div class="highlight">
<pre><span class="c1"># (in IRB)</span>
<span class="nb">require</span> <span class="s1">'builder'</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Builder</span><span class="o">::</span><span class="no">XmlMarkup</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; "&lt;inspect/&gt;"</span>
</pre>
</div>

      <ul>
        <li>IRB calls inspect on the result of an expression in order to
show you the result</li>
        <li>Builder intercepts the call in inspect and creates a tag...</li>
        <li>Simplicity ~= Simplistic</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>That can be really handy</h1></hgroup>
      <ul>
        <li>Builder just works with a string, and provides access to
that string</li>
        <li>If you need to just shove something into the output, you can</li>
        <li>Like, for example, IE Conditional Comments in HTML</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span> <span class="o">|</span><span class="n">xml</span><span class="o">|</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">head</span> <span class="p">{</span> <span class="o">|</span><span class="n">xml</span><span class="o">|</span>  <span class="n">xml</span><span class="o">.</span><span class="n">title</span> <span class="s2">"Title goes here"</span> <span class="p">}</span>
  <span class="n">xml</span> <span class="o">&lt;&lt;</span> <span class="o">&lt;&lt;-</span><span class="no">EOS</span>
<span class="sh">  &lt;!--[if IE]&gt;</span>
<span class="sh">  &lt;body class="ie"&gt;</span>
<span class="sh">  &lt;![endif]--&gt;</span>
<span class="sh">  &lt;!--[if !IE]&gt;--&gt;</span>
<span class="sh">  &lt;body&gt;</span>
<span class="sh">  &lt;!--&lt;![endif]&gt;--&gt;</span>
<span class="no">  EOS</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">h1</span> <span class="s2">"Not entirely well-formed"</span>
  <span class="n">xml</span> <span class="o">&lt;&lt;</span> <span class="s2">"  &lt;/body&gt;</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>
</pre>
</div>

    </section>
    <section>
      <div class="highlight">
<pre><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title goes here<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="c">&lt;!--[if IE]&gt;</span>
<span class="c">  &lt;body class="ie"&gt;</span>
<span class="c">  &lt;![endif]--&gt;</span>
  <span class="c">&lt;!--[if !IE]&gt;--&gt;</span>
  <span class="nt">&lt;body&gt;</span>
  <span class="c">&lt;!--&lt;![endif]&gt;--&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Not entirely well-formed<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>What about attributes?</h1></hgroup>
      <ul>
        <li>Since element creation is a method call, attributes are
arguments to that method call</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="ss">:lang</span> <span class="o">=&gt;</span> <span class="s1">'en'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">xml</span><span class="o">|</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
<span class="c1"># =&gt; &lt;html lang="en"&gt;...&lt;/html&gt;</span>
<span class="n">xml</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">"Paragaph text"</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">"example"</span><span class="p">)</span>
<span class="c1"># =&gt; &lt;p class="example"&gt;Paragraph text&lt;/p&gt;</span>
<span class="n">xml</span><span class="o">.</span><span class="n">p</span><span class="p">({</span><span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">"example"</span><span class="p">},</span> <span class="s2">"Paragaph text"</span><span class="p">)</span>
<span class="c1"># =&gt; &lt;p class="example"&gt;Paragraph text&lt;/p&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Another digression, this time into Ruby syntax</h1></hgroup>
      <ul>
        <li>Ruby allows you to omit the parentheses from method calls</li>
        <li>(Operator precedence can hurt you here, particularly with
blocks</li>
        <li>Ruby doesn't actually have keyword arguments.</li>
        <li>What it does do is assume the last argument to a method is a
hash if it looks like one, so:</li>
      </ul>
      <div class="highlight">
<pre><span class="n">object</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"mum"</span><span class="p">)</span> <span class="c1"># is the same as</span>
<span class="n">object</span><span class="o">.</span><span class="n">method</span><span class="p">({</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"mum"</span><span class="p">})</span>

<span class="n">object</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="s2">"arg"</span><span class="p">,</span> <span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"mum"</span><span class="p">)</span> <span class="c1"># is the same as</span>
<span class="n">object</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="s2">"arg"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"mum"</span><span class="p">})</span>

<span class="n">object</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"mum"</span><span class="p">,</span> <span class="s2">"arg"</span><span class="p">)</span> 
<span class="c1"># =&gt; SyntaxError: (irb):1: syntax error, unexpected ')', expecting tASSOC)</span>

<span class="n">object</span><span class="o">.</span><span class="n">method</span> <span class="ss">:key</span> <span class="o">=&gt;</span> <span class="n">value</span>
<span class="n">object</span><span class="o">.</span><span class="n">method</span> <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="c1"># in 1.9</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Namespaces</h1></hgroup>
      <ul>
        <li>There are two ways to do this</li>
        <li>Neither is what I'd call pretty</li>
        <li>Fortunately Attributes are easy</li>
      </ul>
      <div class="highlight">
<pre><span class="c1"># default namespace (easy)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">elementName</span><span class="p">(</span><span class="n">xmlns</span><span class="p">:</span> <span class="s1">'http://a.url/'</span><span class="p">)</span>
<span class="c1"># declared namespace</span>
<span class="n">doc</span><span class="o">.</span><span class="n">prefix1</span> <span class="ss">:elementName</span><span class="p">,</span> <span class="s1">'xmlns:prefix1'</span> <span class="o">=&gt;</span> <span class="s1">'http://a.url/1'</span>
<span class="n">doc</span><span class="o">.</span><span class="n">tag!</span><span class="p">(</span><span class="s1">'prefix2:elementName'</span><span class="p">,</span> <span class="s1">'xmlns:prefix2'</span> <span class="o">=&gt;</span> <span class="s1">'http://a.url/2'</span><span class="p">)</span>

<span class="c1"># &lt;elementName xmlns="http://a.url/"/&gt;</span>
<span class="c1"># &lt;prefix1:elementName xmlns:prefix1="http://a.url/1"/&gt;</span>
<span class="c1"># &lt;prefix2:elementName xmlns:prefix2="http://a.url/2"/&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Namespaces are not real</h1></hgroup>
      <ul>
        <li>Very important, this.</li>
        <li>Remember, it's just a string</li>
      </ul>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Builder</span><span class="o">::</span><span class="no">XmlMarkup</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:indent</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">doc</span><span class="o">.</span><span class="n">instruct!</span>
<span class="n">doc</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">'xmlns'</span> <span class="o">=&gt;</span> <span class="s1">'&amp;'</span><span class="p">,</span> <span class="s1">'xmlns:woo'</span> <span class="o">=&gt;</span> <span class="s1">'http:a.url/'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">.</span><span class="n">head</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
<span class="n">n</span><span class="o">.</span><span class="n">tag!</span><span class="p">(</span><span class="s1">'wah:title'</span><span class="p">,</span> <span class="s2">"Hello there"</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">doc</span><span class="o">.</span><span class="n">target!</span> <span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;html xmlns="&amp;amp;"  xmlns:woo="http:a.url/"&gt;</span>
<span class="c1">#   &lt;head&gt;</span>
<span class="c1">#     &lt;wah:title&gt;Hello there&lt;/wah:title&gt;</span>
<span class="c1">#   &lt;/head&gt;</span>
<span class="c1"># &lt;/html&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Builder, in conclusion</h1></hgroup>
      <ul>
        <li>The best thing about Builder is that all it knows how to do
is nest tags and escape strings</li>
        <li>The worst thing about Builder is that all it knows how to do
is nest tags and escape strings</li>
        <li>When the problems outweigh the simplicity, use a different
tool</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Generating XML with Nokogiri</h1></hgroup>
      <ul>
        <li>Nokogiri is quite happy to create new, and manipulate
existing, documents</li>
        <li>You can use the DOM-ish API we looked at earlier</li>
        <li>Or, you can use its Builder-like DSL.</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>The DOM-ish way</h1></hgroup>
      <div class="highlight">
<pre><span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="o">::</span><span class="no">Document</span><span class="o">.</span><span class="n">new</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="s2">"misterTag"</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="c1"># or, </span>
<span class="n">doc</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="s1">'&lt;misterTag&gt;'</span><span class="p">)</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>The Builder-like way</h1></hgroup>
      <div class="highlight">
<pre><span class="n">builder</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="o">::</span><span class="no">Builder</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">xml</span><span class="o">|</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">misterTag</span><span class="p">(</span><span class="s1">'xmlns:prefix'</span> <span class="o">=&gt;</span> <span class="s1">'http://a.url/'</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">xml</span><span class="o">[</span><span class="s1">'prefix'</span><span class="o">].</span><span class="n">element</span><span class="p">(</span><span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">"one"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="n">builder</span><span class="o">.</span><span class="n">to_xml</span>
<span class="c1"># &lt;?xml version="1.0"?&gt;</span>
<span class="c1"># &lt;misterTag xmlns:prefix="http://a.url/"&gt;</span>
<span class="c1">#   &lt;prefix:element id="one"/&gt;</span>
<span class="c1"># &lt;/misterTag&gt;</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>DOM scripting</h1></hgroup>
      <ul>
        <li>What is it?</li>
        <li>jQuery</li>
        <li>The basics</li>
        <li>In the page</li>
        <li>Debugging and exploration in other people's pages</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>What is DOM scripting?</h1></hgroup>
      <ul>
        <li>DOM scripting is the process of applying the techniques of
programmatic manipulation of a document to a 'live' DOM</li>
        <li>(It's just a fancy way of talking about live manipulation of a web
page in a browser)</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Why would I be interested? (and why cover it here and
not with the HTML / CSS / JS stuff?)</h1></hgroup>
      <ul>
        <li>DOM scripting, of one kind of another, is the basis for all
dynamic &ndash; where the page is updated without refreshing &ndash; web apps</li>
        <li>AJAX (hereafter Ajax, because the term is now so broadly
applied) is simply DOM Scripting + network access</li>
        <li>More pertinently, a whole raft of things which are now taken
for granted, and which you may want to use, rely entirely on it (Google Maps, for one)</li>
        <li>A lot of third-party integrations you may want (or be unable to avoid
(like Facebook) require its use: Facebook's ID service, for example,
requires the use of DOM scripting</li>
        <li>We're going to stay pretty focussed on some specific
techniques and technologies to allow us to integrate Google Maps into
Pub Finder General later, and Norm's going to give a much broader
overview in his session</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>DOM Scripting == Javascript</h1></hgroup>
      <ul>
        <li>Javascript is the only universally available language to
developers in web browsers</li>
        <li>It's actually a really powerful language, with a whole set
of very powerful dynamic features (closures,
function-as-first-class-objects)</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Javascript ~= Lisp</h1></hgroup>
      <ul>
        <li>Although it has Java in the name and C-like syntax, it has
nothing at all to do with Java, and very little to do with C</li>
        <li>It's actually closer to Lisp, albeit a weird variety with a
few carbunkles</li>
      </ul>
      <hgroup><h1>Javascript in the context of the browser</h1></hgroup>
      <ul>
        <li>The thing that makes Javascript powerful in the context of
the browser are the APIs that are exposed</li>
        <li>We can call these the DOM, although there's a few more
things there (particularly with the HTML 5 efforts, as you'll see
later).</li>
        <li>When we talk about DOM scripting we're really talking about
making use of these APIs through Javascript, so most of what we need to
cover are APIs rather than the language itself</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Core techniques</h1></hgroup>
      <ul>
        <li>DOM traversal (finding stuff)</li>
        <li>DOM manipulation (changing stuff)</li>
        <li>Ajax (talking to the outside worls</li>
        <li>Event handling and dispatch (tying everything together)</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Event handling</h1></hgroup>
      <p>Somewhat perversely, this is the best starting point</p>
      <ul>
        <li>In the Bad Old Days (circa NN3/4) certain things had
programmatic hooks, and click events were one of the first:</li>
      </ul>
      <div class="highlight">
<pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://a.url/"</span> <span class="na">onclick=</span><span class="s">"f('http://a.url/'); return false"</span><span class="nt">&gt;</span>Hi!<span class="nt">&lt;/a&gt;</span>
</pre>
</div>

      <ul>
        <li>What we have here is an event handler declared with inline Javascript. The <span data-lang="javascript">return false</span> bit is there to prevent the default action (i.e. following the link) from happening.</li>
        <li>There were a range of events you could hook into this way:</li>
      </ul>
      <div class="highlight">
<pre><span class="nx">onload</span>   <span class="nx">onunload</span> <span class="c1">// Document load</span>
<span class="nx">onclick</span>  <span class="nx">onmousedown</span> <span class="nx">onmouseup</span> <span class="nx">onmouseover</span> <span class="nx">onmouseout</span> <span class="c1">// Mouse events</span>
<span class="nx">onsubmit</span> <span class="nx">onchange</span> <span class="c1">// Form events</span>
</pre>
</div>

    </section>
    <section>
      <hgroup><h1>Event handling</h1></hgroup>
      <ul>
        <li>That was the 'DOM Level 0' events</li>
        <li>APIs for registering event handlers were developed and
standardised as the W3C's DOM Level 2:</li>
      </ul>
      <div class="highlight">
<pre><span class="nx">load</span>   <span class="nx">unload</span> <span class="c1">// Document load</span>
<span class="nx">click</span>  <span class="nx">mousedown</span> <span class="nx">mouseup</span> <span class="nx">mouseover</span> <span class="nx">mouseout</span> <span class="c1">// Mouse events</span>
<span class="nx">submit</span> <span class="nx">change</span> <span class="c1">// Form events</span>
</pre>
</div>

      <ul>
        <li>I jest. The critical thing was the standardisation of event
propagation and event registration</li>
        <li>Events (and therefore event handling) are the foundation of
javascript-reliant web apps - events are how the browser relays the
user's actions to your javascript</li>
        <li>Despite the DOM Level 2 standardisation, there were still
cross-browser interop problems with event handler registration. Instead
of showing you the 'native' APIs I'm going to hide behind the event
API of the jQuery library, which papers over the cracks.</li>
        <li>jQuery is awesome, and (rather elegantly) papers over a great many
cross-browser cracks. I'll be using it in the examples very heavily</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Registering an event handler</h1></hgroup>
      <ul>
        <li>Let's register an event handler, and then dissect it a bit</li>
      </ul>
      <div class="highlight">
<pre><span class="nx">node</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">do_something_with</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">node</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="nx">do_something_with</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

      <ul>
        <li>A handler function is registered by calling a method with
the same name as the event on the jQuery node of the element we're
interested in. The method's argument is a function which can be a
reference to a function, or an anonymous function (as in our example)</li>
        <li>The callback function has an optional argument
<code>e</code>, the DOM L2 event object,
which contains lots of information about the event (this is very useful
for mouse and keyboard events). <code>this</code> refers to the DOM node
which caused captured the event (although not necessarily the node on which
the event was originally triggered)</li>
        <li>Calling <code>preventDefault()</code> on the event object
has the same effect as the old <code>return false</code> approach</li>
      </ul>
    </section>
    <section>
      <hgroup><h1>Traversal: finding things to act on</h1></hgroup>
      <ul>
      </ul>
    </section>
    <section>
      <hgroup><h1>Sprucing up Pub Finder General</h1></hgroup>
      <ul>
        <li>Integrating the Google Places API</li>
        <li>Provding data for our own basic API</li>
      </ul>
    </section>
	</div>


	<script src="lib/jquery-1.5.2.min.js"></script>
	<script src="lib/jquery.jswipe-0.1.2.js"></script>
	<script src="lib/htmlSlides.js"></script>
	<script>
$(function() {
		htmlSlides.init({ hideToolbar: true });
});
	</script>
</body>
</html><!--
    <section>
      <hgroup><h1></h1></hgroup>
      <ul>
        <li></li>
      </ul>
      <pre data-lang="javascript"><![CDATA[
]]></pre>
    </section>
-->
